
<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta Access-Control-Allow-Origin: https://function-airtracker-sigfox-callback.azurewebsites.net>
  <meta name="robots" content="noindex, nofollow">
  <meta name="googlebot" content="noindex, nofollow">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.2.1/angular.js"></script>
  <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBfICw1Yc-dPq0XWnbPP5ReFmYbrdVWYk0"></script>
  <style type="text/css">
    #gmaps {
        width: 450px;
        height: 450px;
    }
  </style>

  <title>AngularJS Google Maps example</title>
<script type="text/javascript">//<![CDATA[

var app = angular.module('myApp', []);


app.directive('myMap', function() {
  // directive link function
  var link = function(scope, element, attrs) {
    var map, infoWindow;
    var markers = [];

    // map config
    var mapOptions = {
      center: new google.maps.LatLng(50, 2),
      zoom: 4,
      mapTypeId: google.maps.MapTypeId.ROADMAP,
      scrollwheel: false
    };

    // init the map
    function initMap() {
      if (map === void 0) {
        map = new google.maps.Map(element[0], mapOptions);
      }
    }

    // place a marker
    function setMarker(map, position, title, content) {
      var marker;
      var markerOptions = {
        position: position,
        map: map,
        title: title,
        icon: 'https://maps.google.com/mapfiles/ms/icons/green-dot.png'
      };

      marker = new google.maps.Marker(markerOptions);
      markers.push(marker); // add marker to array

      google.maps.event.addListener(marker, 'click', function() {
        // close window if not undefined
        if (infoWindow !== void 0) {
          infoWindow.close();
        }
        // create new window
        var infoWindowOptions = {
          content: content
        };
        infoWindow = new google.maps.InfoWindow(infoWindowOptions);
        infoWindow.open(map, marker);
      });
    }

    // show the map and place some markers
    initMap();
    var $http = angular.injector(["ng"]).get("$http");
    var url = 'https://function-airtracker-sigfox-callback.azurewebsites.net/api/sensors?code=K4bQoTTabS7HGSdwa/bXF5Zqay93nC/RRcfWZmNTaqeuenzp/e4gag==';
    $http.get(url).then(function (response) {
        console.log(response);
        for(var i = 0; i < response.data.length; i++) {
            var sensor = response.data[i];
            setMarker(map, new google.maps.LatLng(sensor.lat, sensor.lon), sensor.city, sensor.content);
        }
//        setMarker(map, new google.maps.LatLng(51.508515, -0.125487), 'London', 'Just some content');
  //      setMarker(map, new google.maps.LatLng(52.370216, 4.895168), 'Amsterdam', 'More content');
    //    setMarker(map, new google.maps.LatLng(48.856614, 2.352222), 'Paris', 'Text here');
    });
  };

  return {
    restrict: 'A',
    template: '<div id="gmaps"></div>',
    replace: true,
    link: link
  };
});

//]]> 

</script>

  
</head>

<body ng-app="myApp">
  <div my-map=""></div>
  <script>
  // tell the embed parent frame the height of the content
  if (window.parent && window.parent.parent){
    window.parent.parent.postMessage(["resultsFrame", {
      height: document.body.getBoundingClientRect().height,
      slug: "None"
    }], "*")
  }
</script>

</body>

</html>

